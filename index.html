<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <title>FocusWork</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <meta name="background-color" content="#0f172a">

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="FocusWork">
  <link rel="apple-touch-icon" href="/FOCUSWORK/icons/icon-192.png">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="styles-client-view.css">
</head>

<body>
  <div class="app">

    <!-- HEADER -->
    <header class="header">
      <div id="clientName" class="client-name">Cap encÃ rrec actiu</div>
      <div id="activityName" class="activity-name">â€”</div>
      <div id="timer" class="timer">00:00:00</div>
      <div id="clientTotal" class="client-total"></div>
      
      <!-- TIEMPO FACTURABLE -->
      <div id="billableTimeBox" class="billable-time-box" style="display: none;"></div>
      
      <!-- AVISO FUERA DE HORARIO DE ENFOQUE -->
      <div id="focusScheduleStatus" style="display: none; margin-top: 8px; padding: 6px 12px; background: rgba(251, 191, 36, 0.2); border-radius: 6px; font-size: 0.85rem; color: #fbbf24; text-align: center;"></div>
    </header>

    <!-- ACTIVIDADES -->
    <section class="panel" id="activitiesPanel">
      <!-- ACCIÃ“ PRINCIPAL -->
      <div class="grid centered" style="margin-top: 12px;">
        <button id="newClientBtn">â• Nou encÃ rrec</button>
        <button id="focusPriorityBtn" class="primary full-width">
          ğŸ‘ï¸ ğŸ”„ Revisar encÃ rrecs
        </button>
      </div>
      
      <!-- GRID D'ACTIVITATS (si n'hi ha) -->
      <div class="grid activities" id="activitiesGrid">
        <!-- aquÃ­ ja podrÃ s posar altres activitats mÃ©s endavant -->
      </div>
    </section>

    <!-- ============================================
         NOVA VISTA DE CLIENT (ESTIL IMATGE)
         ============================================ -->
    <section class="client-detail-view" id="clientInfoPanel" style="display: none;">
      
      <!-- CAPÃ‡ALERA DEL CLIENT -->
      <div class="client-header">
        <button class="back-btn" id="backToMainBtn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <h1 class="client-header-title" id="clientHeaderTitle">Client Example</h1>
        <span class="urgent-badge" id="urgentBadge" style="display: none;">Urgent</span>
      </div>

      <!-- ACCIONS RÃ€PIDES -->
      <div class="quick-actions">
        <button class="quick-action-btn" id="quickCallBtn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
          </svg>
        </button>
        <button class="quick-action-btn" id="quickEmailBtn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
            <polyline points="22,6 12,13 2,6"/>
          </svg>
        </button>
        <button class="quick-action-btn" id="quickPhotoBtn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
            <circle cx="12" cy="13" r="4"/>
          </svg>
          <span class="badge-plus">+</span>
        </button>
      </div>

      <!-- DATA D'ENTREGA -->
      <div id="deliveryDateBox" class="delivery-info-card hidden"></div>

      <!-- TASQUES AMB PRIORITATS -->
      <div class="tasks-section">
        
        <!-- TASCA URGENT (AVUI) -->
        <div class="task-card urgent-task">
          <div class="task-header" id="urgentTaskHeader">
            <div class="task-header-left">
              <span class="task-dot urgent-dot"></span>
              <span class="task-label">AVUI</span>
              <span class="task-date" id="urgentTaskDate">30/01/2026</span>
            </div>
            <button class="task-toggle" id="urgentTaskToggle">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </button>
          </div>
          <div class="task-content" id="urgentTaskContent">
            <textarea 
              id="taskUrgent" 
              class="task-textarea"
              placeholder="Notes del client, tasques pendents, detalls del projecte..."
            ></textarea>
            <button class="task-edit-btn" id="urgentEditBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- TASCA IMPORTANT (SEGÃœENT PAS) -->
        <div class="task-card important-task">
          <div class="task-header" id="importantTaskHeader">
            <div class="task-header-left">
              <span class="task-dot important-dot"></span>
              <span class="task-label">SegÃ¼ent pas</span>
            </div>
            <button class="task-toggle" id="importantTaskToggle">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </button>
          </div>
          <div class="task-content" id="importantTaskContent" style="display: none;">
            <div class="task-item">
              <span class="task-item-dot"></span>
              <textarea 
                id="taskImportant" 
                class="task-textarea-inline"
                placeholder="Enviar proposta final"
              ></textarea>
              <button class="task-item-toggle">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- TASCA QUAN ES PUGUI -->
        <div class="task-card later-task">
          <div class="task-header" id="laterTaskHeader">
            <div class="task-header-left">
              <span class="task-dot later-dot"></span>
              <span class="task-label">Quan es pugui</span>
              <span class="task-count" id="laterTaskCount">(1 tasca amagada)</span>
            </div>
            <button class="task-toggle" id="laterTaskToggle">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </button>
          </div>
          <div class="task-content" id="laterTaskContent" style="display: none;">
            <div class="task-item">
              <button class="task-history-btn" id="laterHistoryBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
                HistÃ²ric
              </button>
              <textarea 
                id="taskLater" 
                class="task-textarea-inline"
                placeholder="Tasques per mÃ©s endavant..."
              ></textarea>
              <button class="task-item-toggle">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- HISTÃ’RIC DE TASQUES -->
        <div class="task-card history-task">
          <div class="task-header">
            <div class="task-header-left">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <span class="task-label">HistÃ²ric</span>
              <span class="task-count">(2 tasques anteriors)</span>
            </div>
          </div>
        </div>

      </div>

      <!-- HORES DEL CLIENT -->
      <div class="client-hours-card">
        <div class="client-hours-header">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          <span class="client-hours-title">Hores del client</span>
          <button class="client-hours-arrow">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </button>
        </div>
        <div class="client-hours-actions">
          <button class="hours-add-btn" id="addHoursBtn">
            <span class="hours-add-icon">+</span>
            <span id="clientTotalDisplay">Avui: 1h 30m</span>
          </button>
          <button class="hours-resume-btn" id="viewResumeBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Resum
          </button>
          <button class="hours-lock-btn" id="lockHoursBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
          </button>
          <button class="hours-menu-btn" id="hoursMenuBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="12" x2="21" y2="12"/>
              <line x1="3" y1="6" x2="21" y2="6"/>
              <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- BOTONS D'ACCIÃ“ -->
      <div class="client-action-buttons">
        <button class="action-button note-btn" id="addNoteActionBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          Afegir nota
        </button>
        <button class="action-button hours-btn" id="addHoursActionBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          Afegir hores
        </button>
        <button class="action-button photo-btn" id="addPhotoActionBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
            <circle cx="12" cy="13" r="4"/>
          </svg>
          Afegir foto
        </button>
        <button class="action-button status-btn" id="changeStatusBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          Canviar estat
        </button>
      </div>

      <!-- FOTOGRAFIES DEL CLIENT -->
      <div class="photos-section">
        <div class="photos-header">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
          </svg>
          <span class="photos-title">Fotografies del client</span>
        </div>
        
        <div class="photos-grid" id="photoGallery">
          <!-- Les fotos es carregaran dinÃ micament aquÃ­ -->
        </div>
      </div>

  
      <!-- BOTONS D'ACCIÃ“ FINALS DEL CLIENT -->
      <div class="client-final-actions">
        <button id="historyBtn" class="btn-secondary-large">
          ğŸ“‚ Clients tancats
        </button>
        <button id="closeClient" class="btn-close-client">
          âœ… Tancar client
        </button>
      </div>

      <!-- BOTÃ“ FLOTANT D'AFEGIR -->
      <button class="fab-button" id="fabAddBtn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
      </button>

    </section>

    <!-- BACKUP Y GESTIÃ“N -->
    <section class="panel">
      <div class="grid">
        <button id="exportWorkBtn">ğŸ’¾ Guardar sessiÃ³</button>
        <button id="importWorkBtn">ğŸ“‚ Carregar treball</button>
        <button id="exportAllBtn" class="full-width">ğŸ“¦ CÃ²pia de seguretat</button>
      </div>
    </section>

    <!-- BORRAR CLIENT (nomÃ©s visible per a clients tancats) -->
    <section class="panel" id="deleteClientPanel" style="display: none;">
      <button id="deleteClientBtn" class="danger">
        ğŸ—‘ï¸ Esborrar aquest client
      </button>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
      <button id="focusBtn">ğŸ¯ Focus</button>
      <button id="scheduleBtn">â° Activar Horari</button>
      <button id="todayBtn">ğŸ“„ Report CSV</button>
    </footer>

    <!-- VERSIÃ“N / ACTIVACIÃ“N -->
    <div id="versionBox" class="version-box">
      <div class="lock">
        ğŸ”’ VersiÃ³ de mostra: fins a 2 clients actius Â·
        â­ LlicÃ¨ncia completa: clients ilÂ·limitats Â· pagament Ãºnic 34â‚¬ (Bizum)
      </div>

      <div class="version-actions">
        <button id="loadLicenseBtn" type="button">
          ğŸ“„ Carregar arxiu amb la llicÃ¨ncia
        </button>

        <button id="requestLicenseBtn" type="button">
          ğŸ’¬ SolÂ·licitar llicÃ¨ncia per WhatsApp
        </button>
      </div>

      <div id="licenseInfo" style="display:none"></div>
    </div>

    <!-- ===============================================
         MODALES
         =============================================== -->

  <!-- MODAL: Nou Client - ID CORREGIT -->
  <div id="modalNewClient" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">â•</span>
        <h2 class="modal-title">Nou encÃ rrec</h2>
      </div>
      <div class="modal-body">
        <label class="modal-label">EncÃ rrec + descripciÃ³ de la feina a realitzar</label>
        <textarea
  id="newClientInput"
  class="workpad-area"
  placeholder="Ex: Joan - Targetes presentaciÃ³"
  rows="2"
  autocomplete="off"
  autocorrect="off"
  autocapitalize="sentences"
  spellcheck="false"
></textarea>

      </div>
     
      
      
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalNewClient')">CancelÂ·lar</button>
        <button class="btn-primary" onclick="confirmNewClient()">Crear</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Fecha de Entrega -->
  <div id="modalDeliveryDate" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“…</span>
        <h2 class="modal-title">Data d'Entrega</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text">Defineix data d'entrega del projecte:</p>
        <input type="date" id="inputDeliveryDate" class="modal-input">
        <p class="modal-text" style="font-size: 0.85rem; opacity: 0.7; margin-top: 12px;">
          ğŸ’¡ Deixa-ho en blanc per eliminar la data de lliurament.
        </p>
        <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid #3b82f6;">
          <p style="margin: 0; font-size: 0.9rem; color: #93c5fd;">
            â„¹ï¸ La data apareixerÃ  a l'Ã rea de tasques urgents i al llistat de clients.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalDeliveryDate')">CancelÂ·lar</button>
        <button class="btn-primary" onclick="saveDeliveryDate()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Afegir Hores Extra -->
  <div id="modalExtraHours" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">â±ï¸</span>
        <h2 class="modal-title">Afegir Hores Extra</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text">Registra hores treballades fora del projecte principal:</p>
        
        <label class="modal-label">Hores</label>
        <input type="number" id="inputExtraHours" class="modal-input" placeholder="Ex: 2.5" step="0.25" min="0.25">
        
        <label class="modal-label">DescripciÃ³</label>
        <input type="text" id="inputExtraDescription" class="modal-input" placeholder="Ex: ReuniÃ³ client, Disseny addicional, etc.">
        
        <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid #3b82f6;">
          <p style="margin: 0; font-size: 0.9rem; color: #93c5fd;">
            â„¹ï¸ Aquestes hores s'afegiran al temps facturable del client.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalExtraHours')">CancelÂ·lar</button>
        <button class="btn-primary" onclick="saveExtraHours()">Afegir</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Veure Hores Extra -->
  <div id="modalViewExtraHours" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“Š</span>
        <h2 class="modal-title">Hores Extra Registrades</h2>
      </div>
      <div class="modal-body">
        <div id="extraHoursList" class="extra-hours-list"></div>
        <div class="total-stats" style="margin-top: 16px;">
          <div class="total-time">
            Total hores extra: <strong id="extraHoursTotal">00:00:00</strong>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-primary" onclick="closeModal('modalViewExtraHours')">Tancar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Informe/Report -->
  <div id="modalReport" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“‹</span>
        <h2 class="modal-title">Informe del Projecte</h2>
      </div>
      <div class="modal-body">
        <pre id="reportContent" class="report-content"></pre>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalReport')">Tancar</button>
        <button class="btn-primary" onclick="copyReport()">ğŸ“‹ Copiar</button>
        <button class="btn-success" onclick="shareReport()">ğŸ“¤ Compartir</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Canviar de client -->
  <div id="modalChangeClient" class="modal-overlay hidden">
    <div class="modal">
           <div class="modal-header">
   <        <h2 class="modal-title">Canviar de client</h2>
      </div>
      <div class="modal-body">
        <div id="activeClientsList" class="clients-list"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalChangeClient')">CancelÂ·lar</button>
      </div>
    </div>
  </div>

 <!-- MODAL: HistÃ²ric - VERSIÃ“N CORREGIDA SIN DUPLICADO -->
<div id="modalHistory" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-icon">ğŸ“‚</span>
      <h2 class="modal-title">HistÃ²ric de clients</h2>
    </div>
    <div class="modal-body">
      <input type="text" id="searchHistory" class="modal-input" placeholder="ğŸ” Buscar client o feina...">
      <div id="historyClientsList" class="clients-list"></div>
    </div>
    
    <!-- âš ï¸ SOLO UN BLOQUE DE BOTONES -->
    <div class="modal-footer">
      <button class="btn-danger" onclick="showBulkDeleteModal()">ğŸ—‘ï¸ Esborrar antics</button>
      <button class="btn-secondary" onclick="closeModal('modalHistory')">Tancar</button>
    </div>
  </div>
 </div>

  <!-- MODAL: Esborrar clients antics (MASSIU) -->
<div id="modalBulkDelete" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-icon">ğŸ—‘ï¸</span>
      <h2 class="modal-title">Esborrar clients antics</h2>
    </div>
    <div class="modal-body">
      <div id="bulkDeleteList"></div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('modalBulkDelete')">CancelÂ·lar</button>
    </div>
  </div>
</div>

  <!-- MODAL: Confirmar Tancar Client -->
  <div id="modalCloseClient" class="modal-overlay hidden">
    <div class="modal modal-confirm">
      <div class="modal-header">
        <span class="modal-icon">âœ…</span>
        <h2 class="modal-title">Tancar client</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="closeClientText"></p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalCloseClient')">CancelÂ·lar</button>
        <button class="btn-success" onclick="confirmCloseClient()">Tancar client</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Exportar abans de tancar -->
  <div id="modalExportBeforeClose" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ’¾</span>
        <h2 class="modal-title">Guardar abans de tancar</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="exportBeforeCloseText"></p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="confirmCloseClient()">No, tancar sense guardar</button>
        <button class="btn-primary" onclick="exportAndClose()">SÃ­, guardar i tancar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Importar Feina -->
  <div id="modalImportWork" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“‚</span>
        <h2 class="modal-title">Importar Feina</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text">Vols importar aquest treball?</p>
        <div style="background: rgba(51, 65, 85, 0.4); padding: 16px; border-radius: 12px; margin: 12px 0;">
          <p style="margin: 8px 0;"><strong>Client:</strong> <span id="importClientName"></span></p>
          <p style="margin: 8px 0;"><strong>Temps total:</strong> <span id="importClientTime"></span></p>
          <p style="margin: 8px 0;"><strong>Fotos:</strong> <span id="importClientPhotos"></span></p>
          <p style="margin: 8px 0;"><strong>Notes:</strong> <span id="importClientNotes"></span></p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalImportWork')">CancelÂ·lar</button>
        <button class="btn-primary" onclick="confirmImport()">Importar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Importar cÃ²pia completa -->
  <div id="modalImportBackup" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ“¦</span>
        <h2 class="modal-title">Restaurar cÃ²pia completa</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" style="color: #fbbf24;">âš ï¸ ATENCIÃ“: aixÃ² restaurarÃ  TOTES les teves dades des de la cÃ²pia de seguretat.</p>
        <div style="background: rgba(51, 65, 85, 0.4); padding: 16px; border-radius: 12px; margin: 12px 0;">
          <p style="margin: 8px 0;"><strong>Total clients:</strong> <span id="importBackupClients"></span></p>
          <p style="margin: 8px 0;"><strong>Clients actius:</strong> <span id="importBackupActive"></span></p>
          <p style="margin: 8px 0;"><strong>Data de la cÃ²pia:</strong> <span id="importBackupDate"></span></p>
          <p style="margin: 8px 0;"><strong>LlicÃ¨ncia inclosa:</strong> <span id="importBackupLicense"></span></p>
        </div>
        <p class="modal-text" style="font-size: 13px; opacity: 0.8;">La pÃ gina es recarregarÃ  automÃ ticament desprÃ©s de restaurar.</p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalImportBackup')">CancelÂ·lar</button>
        <button class="btn-success" onclick="confirmImportBackup()">Restaurar cÃ²pia</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Confirmar Eliminar Client -->
  <div id="modalDeleteClient" class="modal-overlay hidden">
    <div class="modal modal-confirm">
      <div class="modal-header">
        <span class="modal-icon">ğŸ—‘ï¸</span>
        <h2 class="modal-title">Eliminar client</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="deleteClientText"></p>
        <label class="modal-label">Escriu ESBORRAR per confirmar</label>
        <input type="text" id="inputDeleteConfirm" class="modal-input" placeholder="ESBORRAR">
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalDeleteClient')">CancelÂ·lar</button>
        <button class="btn-danger" onclick="confirmDeleteClient()">Eliminar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Focus diari -->
  <div id="modalEnfoque" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">ğŸ¯</span>
        <div>
          <h2 class="modal-title">Focus diari</h2>
          <p class="modal-subtitle" id="modalUserName"></p>
        </div>
      </div>
      <div class="modal-body">
        <div class="activity-list" id="modalActivityList"></div>
        <div class="total-stats">
          <div class="total-time">
            Total treballat: <strong id="modalTotalTime"></strong>
          </div>
        </div>
        <div id="modalFocusState" class="focus-state"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-primary" onclick="closeModal('modalEnfoque')">Acceptar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Configurar horari Focus diari -->
  <div id="modalSchedule" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">â°</span>
        <h2 class="modal-title">Horari de Focus diari</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" style="opacity: 0.8; margin-bottom: 20px;">
          L'enfocament nomÃ©s comptabilitza el temps dins de l'horari configurat. Fora d'aquest horari pots continuar treballant, perÃ² no afecta les mÃ¨triques d'enfocament.
        </p>

        <label class="modal-label" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; cursor: pointer;">
          <input type="checkbox" id="scheduleEnabled" style="width: 20px; height: 20px; cursor: pointer;">
          <span>Activar Horari de Focus diari</span>
        </label>

        <div id="scheduleConfig" style="display: none;">
          <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
            <div style="flex: 1;">
              <label class="modal-label">Hora inici</label>
              <input type="time" id="scheduleStart" class="modal-input" value="09:00">
            </div>
            <div style="flex: 1;">
              <label class="modal-label">Hora fi</label>
              <input type="time" id="scheduleEnd" class="modal-input" value="17:00">
            </div>
          </div>

          <div class="schedule-presets">
            <p class="modal-label" style="margin-bottom: 10px;">Predefinits rÃ pids:</p>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
              <button class="btn-secondary" onclick="applyPreset('07:00', '14:00')">ğŸŒ… MatÃ­<br><small>07:00 - 14:00</small></button>
              <button class="btn-secondary" onclick="applyPreset('15:00', '22:00')">ğŸŒ† Tarda<br><small>15:00 - 22:00</small></button>
              <button class="btn-secondary" onclick="applyPreset('09:00', '17:00')">ğŸ¢ Oficina<br><small>09:00 - 17:00</small></button>
              <button class="btn-secondary" onclick="applyPreset('09:00', '18:00')">ğŸ’¼ Complet<br><small>09:00 - 18:00</small></button>
            </div>
          </div>

          <div style="margin-top: 20px; padding: 12px; background: rgba(0, 255, 136, 0.1); border-radius: 8px; border-left: 3px solid #00ff88;">
            <p style="margin: 0; font-size: 13px; color: #00ff88;">
              <strong id="schedulePreview">09:00 - 17:00</strong>
            </p>
            <p style="margin: 5px 0 0; font-size: 12px; opacity: 0.7;">
              DuraciÃ³: <span id="scheduleDuration">8h 0m</span>
            </p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalSchedule')">CancelÂ·lar</button>
        <button class="btn-primary" onclick="saveScheduleConfig()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: ConfiguraciÃ³n de cÃ²pies automÃ tiques -->
  <div id="modalBackupConfig" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-icon">âš™ï¸</span>
        <h2 class="modal-title">ConfiguraciÃ³ de cÃ²pies</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" style="opacity: 0.8; margin-bottom: 20px;">
          Configura les cÃ²pies de seguretat automÃ tiques a Google Drive. Es faran cada mitjanit.
        </p>

        <label class="modal-label" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; cursor: pointer;">
          <input type="checkbox" id="autoDriveBackupCheckbox" style="width: 20px; height: 20px; cursor: pointer;">
          <span>Activar cÃ²pies automÃ tiques a Drive</span>
        </label>

        <div style="padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid #3b82f6;">
          <p style="margin: 0; font-size: 0.9rem; color: #93c5fd;">
            â„¹ï¸ Els backups es guardaran automÃ ticament al teu Google Drive cada dia a mitjanit
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalBackupConfig')">CancelÂ·lar</button>
        <button class="btn-primary" onclick="saveBackupConfig()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Eliminar Foto -->
  <div id="modalDeletePhoto" class="modal-overlay hidden">
    <div class="modal modal-confirm">
      <div class="modal-header">
        <span class="modal-icon">ğŸ—‘ï¸</span>
        <h2 class="modal-title">Eliminar foto</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text">Eliminar aquesta foto del client?</p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modalDeletePhoto')">CancelÂ·lar</button>
        <button class="btn-danger" onclick="confirmDeletePhoto()">Eliminar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Avisos (substitueix alert genÃ¨ric) -->
  <div id="modalAlert" class="modal-overlay hidden">
    <div class="modal modal-alert">
      <div class="modal-header">
        <span class="modal-icon" id="alertIcon">â„¹ï¸</span>
        <h2 class="modal-title" id="alertTitle">AvÃ­s</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="alertText"></p>
      </div>
      <div class="modal-footer">
        <button class="btn-primary" onclick="closeModal('modalAlert')">Acceptar</button>
      </div>
    </div>
  </div>

  </div>

  <!-- SCRIPTS -->
  <script src="app-core.js"></script>
  <script src="app-db.js"></script>
  <script src="app-ui.js"></script>
  <script src="app-client-view.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/FOCUSWORK/sw-v2.js", {
          scope: "/FOCUSWORK/"
        });
      });
    }
  </script>

  <!-- BOTÃ“ FLOTANT PER SORTIR DEL CLIENT -->
  <div id="floating-layer">
    <button id="exitClientFloating" class="hidden">
       â†© Sortir del client
    </button>
  </div>

  <!-- Lightbox per galeria de fotos -->
  <div class="lightbox-overlay" id="lightbox">
    <div class="lightbox-header">
      <div class="lightbox-info">
        <div class="lightbox-counter" id="lightboxCounter">1 / 1</div>
        <div class="lightbox-date" id="lightboxDate">â€”</div>
      </div>
      <button class="lightbox-close" onclick="closeLightbox()">Ã—</button>
    </div>
    
   <div class="lightbox-canvas-container">
    <button class="lightbox-nav lightbox-nav-prev" onclick="prevPhoto()">â€¹</button>
    <canvas id="photoCanvas"></canvas>
    <button class="lightbox-nav lightbox-nav-next" onclick="nextPhoto()">â€º</button>
  </div>

  <!-- Toolbar d'ediciÃ³ (just desprÃ©s del canvas) -->
  <div class="editor-toolbar">
    <button class="color-picker-mini active" style="background: #ef4444;" onclick="setDrawColor('#ef4444')" data-color="#ef4444"></button>
    <button class="color-picker-mini" style="background: #f59e0b;" onclick="setDrawColor('#f59e0b')" data-color="#f59e0b"></button>
    <button class="color-picker-mini" style="background: #10b981;" onclick="setDrawColor('#10b981')" data-color="#10b981"></button>
    <button class="color-picker-mini" style="background: #3b82f6;" onclick="setDrawColor('#3b82f6')" data-color="#3b82f6"></button>
    <button class="color-picker-mini" style="background: white;" onclick="setDrawColor('#ffffff')" data-color="#ffffff"></button>
    
    <div style="width: 2px; height: 25px; background: rgba(255,255,255,0.2);"></div>
    
    <input type="range" class="size-slider-mini" min="2" max="8" value="3" id="drawSize" oninput="updateDrawSize(this.value)">
    
    <button class="editor-btn-small" onclick="toggleDrawing()" id="drawToggle">
      <span>âœï¸</span>
      <span id="drawToggleText">Dibuixar</span>
    </button>
    
    <button class="editor-btn-small" onclick="undoDraw()">
      <span>â†¶</span>
      <span>Desfer</span>
    </button>
    
    <button class="editor-btn-small" onclick="clearDrawing()">
      <span>ğŸ—‘ï¸</span>
      <span>Netejar</span>
    </button>
    
    <button class="editor-btn-small" onclick="saveEditedPhoto()" style="background: rgba(16, 185, 129, 0.2); border-color: rgba(16, 185, 129, 0.4);">
      <span>ğŸ’¾</span>
      <span>Guardar canvis</span>
    </button>
  </div>
    
  <div class="lightbox-footer">
    <!-- Camp de comentari NOU -->
    <div class="lightbox-comment-container">
      <textarea 
        id="lightboxComment" 
        class="lightbox-comment-input" 
        placeholder="ğŸ’¬ Afegeix un comentari a aquesta foto..."
        rows="2"
      ></textarea>
    </div>
    
    <!-- Botons existents -->
    <div class="lightbox-buttons">
      <button class="lightbox-btn" onclick="downloadCurrentPhoto()">
        <span>â¬‡ï¸</span>
        <span>Descarregar</span>
      </button>
      <button class="lightbox-btn" onclick="shareCurrentPhoto()">
        <span>ğŸ“¤</span>
        <span>Compartir</span>
      </button>
      <button class="lightbox-btn danger" onclick="deleteCurrentPhoto()">
        <span>ğŸ—‘ï¸</span>
        <span>Esborrar</span>
      </button>
    </div>
  </div>
  </div>

</body>
</html>
